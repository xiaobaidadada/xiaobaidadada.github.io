

# 一致性

一致性在不同的场景下，比如数据库的事物，分布式系统，代表的意义是不一样的，但是肯定有着相似本质含义，这个含义就是：

**数据在一个过程中，每个时刻（不管数据在什么位置，什么节点），都在一定程度上符合目标的要求。**

所以有四个属性：

1. 数据
2. 数据操作过程
3. 数据的位置
4. 数据在过程中的时刻

一致性也分，强一致性，弱一致性，最终一致性。强一致性如果某个节点失败，整个行为就算失败。弱一致性和最终一致性一般是同一个含义，最终一致性是弱一致性的一个实例，中间时刻允许有不符合目标的情况，最终会满足目标。

# 数据库事物中的一致性

事物有四个基本性质，ACID，原子性，隔离性，持久性，一致性。

这里的一致性指的是，在事物的开始和结束，或者其它任意时刻，数据也就是记录本身，要满足数据库的约束，没有被损毁，满足持久性等目标。

# 分布式系统中的一致性

## CAP理论

就是一致性C，可用性A，分区容错性P；

这里的一致性指的是，强一致性，数据在任何时刻，任何节点，都要不能出现任何意外，如果出现意外整个操作行为就失败，可以再次尝试发起整个行为。

这里的分区容错性，指的是最终一致性，允许出现在时间和位置上的数据顺序，或者损毁，但是最后要满足数据达到目标。

所以C和P是矛盾的，这三个的组合同时只能同时满足两个。

**但是A肯定是首要满足的前提，做系统如果系统不可用，就没有存在的意义。**

## 分布式下的一致性

分布式系统，一般指的是一个软件，可以把一般的软件分为，业务系统层，中间件层，数据库层。

我们的业务代码，一般是强一致性的，表现为用户的请求如果分布式的某个节点失败了，整个请求就算失败，全部回滚（开发上简单，节约时间）。但是一般对于高并发的场景，我们可以排队，让某个请求先延迟一下，最终达到目的。

数据中间件层，基本全部都是最终一致性，比如kafka和rabbitmq，这些软件自身可以有分区副本，在分布式部署模式下，并不能保证副本都成功，也不能严格保证顺序，只保证生产和消费成功。

在数据库，是不管是事物还是分布式副本部署场景都普遍是强一致性。



