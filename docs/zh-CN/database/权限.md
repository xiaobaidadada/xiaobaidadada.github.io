# 权限管理

数据库课程有专门的章节，但是不仅仅是数据库本身具有这个功能，牵扯到数据的软件，一般都有这个功能，所以开发得时候这也是一个很重要得事情；其实数据库系统设计这门课，讲的东西是后端数据处理模块功能得一个子集；

基本的功能有

1. 身份鉴别，让系统识别是你谁，你在数据库中是哪个记录，一般是用账号密码；
2. 访问权限控制，无论哪种设计，都可以归结到这几种办法上：
   1. DAC，自主访问控制（基于自身权限），自主控制，每个主体拥有什么权限，他也有权力去分配给别人自己的权力；
   2. MAC，强制访问控制模型（基于不变得控制权限），每个主体拥有什么权限，是由有个特级人员规定的，他不能分享自己的权限；
   3. RBAC，基于角色的访问控制模型，每个主体拥有什么权限，能不能分享自己的权限，需要知道自己是属于什么角色，角色和角色组是由特级人员规定的（或者开发人员规定的）；
   4. ABAC，基于属性的访问控制模型，是根据主体的属性，通过特定程序的计算，得出他是什么权限，而需要别的特殊说明，由属性模型和算法决定；就是通过属性判断符不符合某个场景；其实这些特殊属性还是权限，只不过支持需要计算才能得出一些权限逻辑；
3. 权限是：**针对一个数据规定的操作集合**，普遍把这些集合叫做访问控制权限，此时数据只是一个接口（也可以看作数据），如果数据不是接口呢，而是接口内部的别的方法呢，或者一些实际的数据呢，不同形式的，不同类型的数据库的数据；此时要关注的问题就多了；就是怎么使权限在其规定的数据操作上生效；



## 权限实际使用的一些框架模型

在java开发邻域，有不少安全框架，比如shiro，或者spring security，从前面分析的权限的实际使用过程来看，这些框架的作用有一下几点：

1. 把身份鉴权和认证做成链式执行规则
2. 提供鉴权节点，且可以自定义；处理办法
3. 提供可选择的会话功能，不必把token放到redis
4. 提供登录用户后获取用户信息以及权限的统一方式（要提前设置）
5. spring securrity还提供了针对于spring mvc接口（看作数据）进行权限标识的便利途径；还能提供内部方法级别的权限验证
6. 。。。



OAuth2：这是一个认证流程，他是用于用户可以在别的网站登录自己的系统，从而让别的网站接入自己，提高流量用的；这个属于认证流程，也是接口外部的；

在java中，各种事情都有框架，mvc，日志，json，orm，等等，这些框架是为了实现复杂的细节部分，但是java中的权限框架，好像都只是在定义执行流程，并没有做多少事；可以从上面的讨论想一想为什么会是这样的局面，先抛开身份认证和获取用户信息啥的这些额外操作吧（作用比小），只说身份认证部分，首先要先把权限标识到一个数据上，shiro根本没有标识，需要自己去做，spring securrity可以用注解；但是数据对象，仅仅是方法的可能性太小了，很可能还有逻辑；这就需要用额外的方法了；这些框架都做不到数据权限和菜单权限；

## 怎么合理的写权限

权限和权限所决定的对象（其操作），是一对多的关系；有的可以直接判定是否可以进行，有的则需要根据权限（属性）进行和其环境参数进行计算得出权限；

1. 首先要注意，权限是什么类型的，
   - 是可复用的（不针对特殊数据的），一般用于系统特定的规则，固定数量的可操作对象
   - 还是针对特定数据存在的（不可复用的）；一般用于不固定的，操作对象；
2. 要进行权限和目标对的绑定，如果是可复用的，就可以直接绑定，注解或者统一枚举啥的都行；如果是针对特定数据的，这个是不需要标识的；此时也可以看出，如果是固定数量的对象是可以绑定的，不是固定数量的对象没法这样 做对应绑定；
3. 在进行判断权限的时候
   - 如果是可重复的绑定，就可以直接进行判断了，这个判断只是判断对应关系，要在处理对象之前进行判断，使用拦截器或者aop进行（java中）
   - 如果是针对特定数据的权限，需要根据用户**自身的权限，也可以说成属性**是什么，用户执行的时候**携带的额外信息**，**这个信息要和目前要操作的对象有关联**，从特定的权限逻辑中得出能否操作这个对象；这个判断不一定只是对应关系了（也可以是)，可以是任何情况的判断；



只要一个系统的功能是特殊的，那么数据模型就可能是特殊的，权限模型来源于数据模型，所以根本无法做一个统一的权限框架，现有的框架只是规定了简单的接口对象和方法数据权限控制；

写权限应该是一个系统的基础业务功能，而不是一个可以被全部抽象出来的功能框架功能；